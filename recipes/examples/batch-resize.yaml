# Batch Image Resize
# Pillow-only recipe â€” no external services needed.
# Demonstrates: batch processing, file operations, image_processor tool.

name: "batch-resize"
version: "1.0"
description: "Resize images in a directory to a target size using Pillow"

inputs:
  - name: "input_dir"
    type: "path"
    required: true
    description: "Directory containing images to resize"

  - name: "output_dir"
    type: "path"
    required: true
    description: "Directory to save resized images"

  - name: "width"
    type: "number"
    default: 256
    description: "Target width in pixels"

  - name: "height"
    type: "number"
    default: 256
    description: "Target height in pixels"

steps:
  - id: "create_output"
    name: "Create output directory"
    tool: "file_ops"
    action: "mkdir"
    inputs:
      path: "{{inputs.output_dir}}"

  - id: "list_images"
    name: "List input images"
    tool: "file_ops"
    action: "list"
    inputs:
      path: "{{inputs.input_dir}}"
      pattern: "*.png"

  - id: "resize_batch"
    name: "Resize all images"
    tool: "batch"
    action: "foreach"
    inputs:
      items: "{{steps.list_images.outputs.files}}"
      workflow_steps:
        - id: "resize"
          tool: "image_processor"
          action: "resize"
          inputs:
            input: "{{item}}"
            output: "{{inputs.output_dir}}/resized_{{item_index}}.png"
            width: "{{inputs.width}}"
            height: "{{inputs.height}}"

cleanup:
  on_success:
    - action: "preserve"
      path: "{{inputs.output_dir}}"
      reason: "output"

# Usage:
# python -m localforge run recipes/examples/batch-resize.yaml \
#   --input "input_dir=./photos" \
#   --input "output_dir=./thumbnails" \
#   --input "width=128" --input "height=128" \
#   --auto-approve
